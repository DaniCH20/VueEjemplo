<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fetch con Vue</title>
  </head>
  <body>
    <div class="app">
      <h2>Lista de Usuarios (Fetch)</h2>

      <button @click="fetchPosts" :disabled="loading">
        {{ loading ? "Cargando..." : "Cargar Usuarios" }}
      </button>

      <div v-if="error" class="error">{{ error }}</div>

      <ul v-else-if="posts.length > 0">
        <li v-for="post in posts" :key="post.id">
          <h3>{{ post.id }} - {{ post.title }}</h3>
          <p>{{ post.body }}</p>
        </li>
      </ul>

      <p v-else-if="!loading">No hay posts todavía.</p>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
      const { ref } = Vue;

      const app = {
        setup() {
          const posts = ref([]);
          const loading = ref(false);
          const error = ref(null);

          async function fetchPosts() {
            loading.value = true;
            error.value = null;

            try {
              const response = await fetch("https://jsonplaceholder.typicode.com/posts");

              if (!response.ok) {
                throw new Error("Error HTTP " + response.status);
              }

              const data = await response.json();
              posts.value = data; // ← CORRECTO
            } catch (err) {
              console.error("Error:", err);
              error.value = "No se pudieron cargar los posts.";
            } finally {
              loading.value = false;
            }
          }

          // IMPORTANTE: si no retornas, Vue no ve nada.
          return { posts, loading, error, fetchPosts };
        },
      };

      Vue.createApp(app).mount(".app");
    </script>
  </body>
</html>
